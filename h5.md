# h5 Sitting ducks #

![huomiokuva](https://www.wgu.edu/content/dam/web-sites/blog-newsroom/blog/images/national/2019/august/grey-hat-hacking.jpg)

# z) Lue artikkelit ja katso videot, tee kustakin muistiinpanot (muutama ranskalainen viiva per artikkeli/video). #

Tässä tehtävässä teen listan niistä tärkeistä kohdista, mistä itse koen olevan hyötyä tunkeutumistestauksessa. Luin artikkelin ja mielestäni siinä oli hyviä kohtia, josta sai käsityksen metasploitista ja lähestymisestä metasploittiin. (PS. en tiedä onko tämän tehtävän raportointi täysin ohjeiden mukainen!)


#### Chapter 1: Approaching a Penetration Test Using Metasploit ####

![huvakuva](https://github.com/samuli-salonen/-Tunkeutumistestaus-ict4tn027-3006-ti-2020s/blob/main/h5/huva.png)

- Penetraatiotestauksen tarkoitus on löytää järjestelmistä haavoittuvuuksia ja heikkouksia.
- Penetraatiotestaus auttaa organisaatiota ymmärtämään järjestelmiensä tietoturvan tilan.
- Oikeanlainen penetraatiotestaus vaatii työkalujen ja metodien hallintaa, jotta tulos olisi luotettava.
- Penauksen oppiminen vaatii tutustumista ja kokeilua, sekä ymmärtämistä verkon ja koneiden elementeistä.
- Hakkerina pitää tietää ja ymmärtää tunkeutumistestauksen rajat kokonaisuudessaan. (IP-alueet, työkalut, kohdeympäristö, aplikaatio, hyökkäyksen tyypit, aika)
- Oikeanlainen tiedustelu ja raportointi on tärkeää, jotta ei toista samoja tunkeutumisyrityksiä ja osaa onnistuttua raportoimaan kohdejärjestelmän ylläpitäjälle.
- Metasploit:n modulien perusteet, eli ymmärtää exploit:n, payload:n, auxiliary, encoder:t ja meterpreter:t.

Lähde: https://learning.oreilly.com/library/view/mastering-metasploit-/9781838980078/B15076_01_Final_ASB_ePub.xhtml#_idParaDest-30

# a) Metasploitable. Asenna Metasploitable 2. Murtaudu sille useilla tavoilla.  #

![metasploitlogo](https://res-3.cloudinary.com/crunchbase-production/image/upload/c_lpad,h_256,w_256,f_auto,q_auto:eco/v1469039917/hodwdopd059vkn2k1b5a.png)

Tätä tehtävää lähdin lähestymään ensin googlettamalla metasploitable2, että mikä se on ja miten sen voisi asentaa omalle virtuaalimasiinalle. Löysin artikkelin, jossa kerrottiin, mikä metasploitable2 on, Metasploitable2 on instanssi alusta, mikä on tarkoitettu penetraatiotestaukseen, joka pohjautuu ubuntuun ja on tarkoituksen mukaisesti tehty haavoittuvaksi.

Lähde: https://docs.rapid7.com/metasploit/metasploitable-2/#:~:text=The%20easiest%20way%20to%20get,and%20other%20common%20virtualization%20platforms.

### Metasploitable2 Asennus ###

Asentaminen lähti etsimällä latauslinkin. Metasploitable 2:n voi ladata Sourceforge:sta.

LatausLinkki:https://sourceforge.net/projects/metasploitable/

Sitten kun ```metasploitable-linux-2.0.0.zip``` oli ladattu unzippasin (Peazip:llä) sen ja laitoin sen omaan instanssikansioon ja avasin sen Oraclen VirtualBox:lla. Tässä piti muistaa asettaa virtuaalikone host-only-network:ssä, jotta kone ei näkyisi ulospäin ja olisi omassa suljetussa verkossaan kali:n kanssa.

![asennuss](https://github.com/samuli-salonen/-Tunkeutumistestaus-ict4tn027-3006-ti-2020s/blob/main/h5/asennuss.png)

Tämän jälkee avasimme virtuaalikoneen ja toimiihan se + kokeilin ifconfig:a kalilla ja MS2:lla:

![toimii](https://github.com/samuli-salonen/-Tunkeutumistestaus-ict4tn027-3006-ti-2020s/blob/main/h5/toimii.png)
Kokeilin myös ping:iä ja kyllä se vain on Metasploitable 2 instanssi!

Sitten Nmap komento, joka on tässä tapauksessa ```sudo nmap -p1-65535 -A 192.168.56.101 -oA metasploitable2```, joka skannaa kaikki TCP portit ja ajaa scriptiengine:llä version tarkastuksen, hopit, banner crabbingit, yms. Tämä komento tekee myös tulostetiedostoja, mitä voidaan hyödyntää myöhemmin (-oA lippu). 

![nmap](https://github.com/samuli-salonen/-Tunkeutumistestaus-ict4tn027-3006-ti-2020s/blob/main/h5/nmapp.png)
![nmap2](https://github.com/samuli-salonen/-Tunkeutumistestaus-ict4tn027-3006-ti-2020s/blob/main/h5/nmapp2.png)
![nmap3](https://github.com/samuli-salonen/-Tunkeutumistestaus-ict4tn027-3006-ti-2020s/blob/main/h5/nmapp3.png)

Siellähän juoksee paljon! Palvelimelta löytyy: 21/tcp FTP tiedostopalvelin, 22/tcp SSH serveri, 23/tcp telnet, 25/tcp smtp sähköpostipalvelin, 53/tcp DNS palvelin, HTTP palvelin (tomcat), netbios, remoteshelliä, samba-tiedostopalvelinta, mysql:llä, X11, irc:iä ja java mounttia. Hakkerin kannalta todella haavoittuvainen palvelin, koska osa palveluista on jo itsesään huonosti suojattuja ja jo vanhentuneita versioita.

### Murtautuminen metasploitable 2 koneelle ###

Tässä kohdassa lähdin tietenkin tarkkailemaan tilannetta kohdekoneessa Nmapilla niinkuin a-kohdassa aiemmin oli tehty. Hakkeroiminen tapahtuu Kali linux:lla tässä tapauksessa ja kohdekoneen IP on host-only-network:ssä: ```192.168.56.101```. Valitsin tähän tehtävään kaksi tapaa murtautua koneelle, jotka on otsikoitu alempana.

#### Murtautuminen 1 - FTP ####

Päätin lähteä murtautumaan koneelle vsftpd 2.3.4 palvelun kautta, sillä kyseessä on FTP-palvelinohjelmisto versio, joka on haavoittuva ja yleensä ftp-palvelimilla voisi olla mielenkiintoista infoa. Koska a-kohdassa oli jo skannattu kohdekone lähdin tässä esimerkissä kirjautumaan metasploitin konsoliin komennolla: ```sudo msfconsole```.

![msf](https://github.com/samuli-salonen/-Tunkeutumistestaus-ict4tn027-3006-ti-2020s/blob/main/h5/consolelogin.png)

Seuraavaksi päätin etsiä haavoittuvuutta komennolla: ```search vsftpd 2.3.4```

![searchftp](https://github.com/samuli-salonen/-Tunkeutumistestaus-ict4tn027-3006-ti-2020s/blob/main/h5/searchftp.png)

Kyllä löytyi! Valitaan exploitti komennolla: ```use exploit/unix/ftp/vsftpd_234_backdoor``` ja tehdään vielä komento: ```show options```, mitä meidän pitää asettaa exploitille rajapinnoiksi.

![rhosti](https://github.com/samuli-salonen/-Tunkeutumistestaus-ict4tn027-3006-ti-2020s/blob/main/h5/rhosti.png)
Huomaa! metasploit valitsee itse defaulttina cmd/unix interact payload:n.

Sitten valitsemme RHOSTS:n komennolla: ```set RHOST 192.168.56.101```, joka on metasploitable 2 kone. Kohdeportti eli 21 oli jo oikein, joten siihen ei tarvitse koskea.

![set](https://github.com/samuli-salonen/-Tunkeutumistestaus-ict4tn027-3006-ti-2020s/blob/main/h5/sett.png)

Lopuksi ajamme exploit kokoonpanon ja katsomme tulokset. Exploitin ajo tapahtuu komennolla ```exploit```.

![exploit](https://github.com/samuli-salonen/-Tunkeutumistestaus-ict4tn027-3006-ti-2020s/blob/main/h5/exploit.png)

Olemme hakkeroituneet sisälle metasploitable koneelle! Nyt meillä on mahdollisuus tehdä koneella mitä vain.

![wein](https://github.com/samuli-salonen/-Tunkeutumistestaus-ict4tn027-3006-ti-2020s/blob/main/h5/wein.png)

Hakkeri voisi tässä tapauksessa varastaa vaikka koneen tietokannat tai poistaa kaikki koneen tiedostot, mutta tässä esimerkissä emme niin tee.

Lähde haavoittuvuuteen: https://www.rapid7.com/db/modules/exploit/unix/ftp/vsftpd_234_backdoor/

#### Murtautuminen 2 - UnreaIRCD ####

Toinen murtautuminen koneelle tapahtui Unreal IRCd service:n kautta. UnrealIRCd on avoimeenlähdekoodiin perustuva Internet Relay Chat-palvelinohjelmisto, jolla voidan viestititellä käyttäjien kesken. (client-server). Hakkerin kannalta IRC-palvelimista voisi saada arkaluontoista dataa esimerkiksi yrityksen sisäisestä viestinnästä. Tällä kertaa päätin tehdä porttiskannauksen metasploit consolin kautta. a-kohdassa aiemmin Nmap antoi IRC-palvelimelle portiksi 6667/tcp, joten kekitämme skannauksen vain tähän porttiin.

Komento porttiskannaukseen msfconsolen kautta: ```db_nmap -p6667 -A 192.168.56.101```

![2nmap](https://github.com/samuli-salonen/-Tunkeutumistestaus-ict4tn027-3006-ti-2020s/blob/main/h5/2nmap.png)



Lähde haavoittuvuuteen:

# b) Skannaa HackTheBoxin verkko niin, että tallennat tulokset Metasploitin tietokantoihin. #

Tässä tehtävässä lähdin avaamalla yhteyden HTB:n verkkoon ja varmistamalla taas, että ollaan oikeassa verkossa samalla tavalla kuin aiempien viikkotehtävienkin kanssa.

# c) Onko joukossa vanhoja tai haavoittuvia versioita? #

Tekstiä

Lähde Läksyihin: http://terokarvinen.com/2020/tunkeutumistestaus-kurssi-pentest-course-ict4tn027-3006-autumn-2020/
