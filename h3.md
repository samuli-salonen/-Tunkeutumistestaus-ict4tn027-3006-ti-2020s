![Nmap](https://startpage.com/av/proxy-image?piurl=https%3A%2F%2Fi0.wp.com%2Fgbhackers.com%2Fwp-content%2Fuploads%2F2017%2F06%2Ftop.ten_.tools_.nmap_-768x432.png%3Ffit%3D696%252C392%26ssl%3D1&sp=1605828795T47d46f8ef50dd533f469d2967642af94b55c110a8edd2d7b1bde26ab1438cd87)
# z) Lue artikkelit ja katso videot, tee kustakin muistiinpanot (muutama ranskalainen viiva per artikkeli/video). Tässä z-kohdassa ei tarvitse tehdä mitään kokeita koneella. #

### 4.1 Understanding Active Reconnaissance ###

* Aktiivisessa tiedustelussa käytetetään porttiskannausta. 
* Aktiivisesta tiedustelusta jää jälkiä lokeihin.
* Aktiivinen tiedustelu pitää myös sisällään haavoittuvuuden tutkimisen.
* Joissakin yrityksissä ei käytetä tunnistusjärjestelmiä.

### 4.2 Exploring Active Reconnaissance Methodologies from an Ethical Hacker Perspective ###
Video piti sisällään seuraavat kohdat, mistä eettinen hakkeri lähestyy palvelua.

* Pitää sisällään portti tiedustelun.
* Palveluiden varmistaminen
* Haavoittuvuuksien tarkistaminen

### 4.3 Surveying Essential Tools for Active Reconnaissance: Port Scanning and Web Service Review ###
Tässä luetellaan tarpeellisia/hyödyllisiä työkaluja hakkerin tiedustelun perspektiivistä.

* Nmap on vakaa ja monikäyttöinen porttiskannaustyökalu.
- On tärkeää tietää portti alueet, output, ip:t.
* Masscan on nopea porttiskanneri. (Ei yhtä monimuotoinen kuin Nmap)
* Udpprotoscanner on porttiskanneri, joka on tarkoitettu UDP portilla toimivien palveluiden löytämiseen.
* EyeWitness on hakkerin työkalu, jolla voidaan priorisoida monen sivun haavoittuvuuksia samanaikaisesti.

### 4.4 Surveying Essential Tools for Active Reconnaissance: Network and Web Vulnerability Scanners ###

* Haavoittuvuus skannaus pitää sisällään verkko ja webbikategoriat, joille on omat työkalut.
* Haavoittuvvuksia voidaan löytää palvelimista monesta paikka ja kartoittaminen vaatii työkalujen rajojen hahmottamisen.
* Haavoittuvuuksien tutkimiseen voidaan tehokkaasti käyttää scriptejä, jotka etsivät palveluiden versioiden haavoittuvuuksia.


# a) Miten nmap toimii? Tee nmapilla seuraavat testit, sieppaa liikenne snifferillä (wireshark) ja analysoi tulokset. #


Nmap lähettää parametrien puitteissa kyselyn Host:lle ja vasteena saa tuloksen onko palvelin/palvelu päällä. Nmap:lla saadaan myös tietoa versiosta, portista, portin statuksesta.

wireshark oli asennettuna Kali 2020.04:ssa valmiina. Komennolla ``` sudo wireshark -i eth0 ``` sain graafisen wireshark:n päälle, jota käytän tässä esimerkissä.

Ensimmäiseksi ajoin testiksi nmap:lla komennon ``` sudo nmap --top-ports 10 -A 10.0.0.64  ``` varmistuakseni, että nmap toimii.

![Tnmap](https://raw.githubusercontent.com/samuli-salonen/-Tunkeutumistestaus-ict4tn027-3006-ti-2020s/main/h3/tnmap.png)
Toimii!

### TCP connect scan -sT ###

Tässä kokeilin taas komentoa: ``` sudo nmap -sT --top-ports 10 -A 10.0.0.64 ```. Wireshark oli pakettien kaappaustilassa samanaikaisesti ja tuloksista saadaan tälläinen otos:

![sTnmap](https://raw.githubusercontent.com/samuli-salonen/-Tunkeutumistestaus-ict4tn027-3006-ti-2020s/main/h3/stscan.png)


Wiresharkkia lukiessa näemme seuraavaa:

![sTnmapt](https://raw.githubusercontent.com/samuli-salonen/-Tunkeutumistestaus-ict4tn027-3006-ti-2020s/main/h3/sttulokset.png)

Tuloksista voimme päätellä sen, että nmap lähettää kyselyn portteihin kuten 443/tcp, 22/tcp/ 80/tcp ja saa vastauksen. Tässä tapahtuu TCP handshake ja voimme nähdä sen wiresharkin lokeista.

### TCP SYN "used to be stealth" scan, -sS (tätä käytetään skannatessa useimmin)  ###

Ajamme tässä kohtaa hyvin samanlaisen komennon kuin aiemmassa kohdassa. Komento on: ``` sudo nmap -sS --top-ports 10 -A 10.0.0.64  ```.

Tuloksena wiresharkkiin saamme seuraavaa:

![ssnmapt](https://raw.githubusercontent.com/samuli-salonen/-Tunkeutumistestaus-ict4tn027-3006-ti-2020s/main/h3/sstulokset.png)

Voimme nähdä, että -sS scannaus on paljon huomaamattomampi, sillä tässä tehdään SYN ja ACK mutta koko kättely puuttuu. 

### ping sweep -sn ###

Sama kuin aiemmin (jälleen), mutta muutamme komennon täysin: ```  sudo nmap -sn 10.0.0.64  ```

Tulokseksi saamme wiresharkkiin:

![snnmapt](https://raw.githubusercontent.com/samuli-salonen/-Tunkeutumistestaus-ict4tn027-3006-ti-2020s/main/h3/sntulokset.png)

Huomaamme, että komento kysyy vain onko host:i ylhäällä. Ja kyllä on!

### don't ping -Pn ###

Komentona toimii tässä tapauksessa: ``` sudo nmap -Pn --top-ports 10 -A 10.0.0.64  ```

Tulokset wiresharkissa:

![PNmap](https://raw.githubusercontent.com/samuli-salonen/-Tunkeutumistestaus-ict4tn027-3006-ti-2020s/main/h3/pnmap.png)

-Pn tekee sen että porttiskannaus skippaa isäntä löydöskyselyn ja jatkaa suoraan porttien löytämiseen. (EI siis lähetä Ping:ä isännälle kysyäkseen onko ylhäällä).

### version detection -sV ###

Komento: ``` sudo nmap -sV -p 80 10.0.0.64  ```.

Tulokset:

![Sv](https://raw.githubusercontent.com/samuli-salonen/-Tunkeutumistestaus-ict4tn027-3006-ti-2020s/main/h3/sv1map.png)

Voimme nähdä tästä, että -sV tutkii kohteen palvelun version ja sen, että onko ylhäällä. -sV:llä pystytään myös erottelemaan filtteröidyt ja filtteröimättömät palvelut.


# b) Nmap:n toimintoja. Kokeile, anna esimerkit, selitä tulokset ja käyttötarkoitus. #

Tulokset

# c) Ninjojen tapaan. Aja nmap-versioskannaus -sV omaan paikalliseen weppipalvelimeen. Weppipalvelimeksi sopii esim 'python3 -m http.server' tai oma apache. Piiloutuuko nmap-skannaus hyvin palvelimelta? #

Asensin omalle palvelinkoneelle Apche2 webbipalvelimen ja vaihdoin ``` /var/www/html/index.html:n ``` näyttämään seuraavalta:

![HTML_sivu](https://raw.githubusercontent.com/samuli-salonen/-Tunkeutumistestaus-ict4tn027-3006-ti-2020s/main/h3/http_kali.png)
Huomaa, että ifconfig näyttää kali:n verkkoadapterin tiedot EI apache2 palvelimen.

Seuraavaksi teemme Nmap porttiskannauksen omalle palvelinkoneelle, eli ``` 10.0.0.64 ``` osoitteeseen.
![HTML_pscan](https://raw.githubusercontent.com/samuli-salonen/-Tunkeutumistestaus-ict4tn027-3006-ti-2020s/main/h3/http_pscan.png)


# d) UDP-skannaus. "Mulla olis vitsi UDP:sta, mutta en tiedä menisikö se perille". Etsi tarvittaessa itse lähteet. #

![udptcp](https://raw.githubusercontent.com/samuli-salonen/-Tunkeutumistestaus-ict4tn027-3006-ti-2020s/main/h3/udp-tcp.jpg)

### Mitkä ovat tavallisimmat tai kiinnostavimmat palvelut, joita UDP-skannauksella voisi löytää? ###

Udp porttiskannauksella voisi löytää mahdollisesti DNS- tai pelipalvelimia, koska UDP protocolla on suotuisampi jatkuvan pakettien syötön ja alhaisen latenssin takia. Myös mahdollisia VoIP-palvelimia voidaan löytää UDP-porttiskannauksella. TCP on näennäisesti turvallisempi protokolla, kun taas UDP on verkolle vähemmän rasittava.

lähde: https://searchnetworking.techtarget.com/definition/UDP-User-Datagram-Protocol

### Miksi UDP-skannaus on hankalaa ja epäluotettavaa? ###

UDP yhteydet ovat "yhteydettömiä" tarkoittaen sitä, että UDP-paketeilta ei odoteta ajallista vastausta vastapäästä takaisin kuten TCP:ssä. Tämä tarkoittaa sitä, että vasteen puutteeseen porttiskannauksessa voi johtaa virheeseen ja oletukseen että portti on kiinni. (Timeout).

### Miksi UDP-skannauksen kanssa kannattaa käyttää --reason flagia? ###

Nmap ei defaulttina tee verkkon "löydös" kyselyä, minkä udp vaatii, vaan kokeilee onko palvelin päällä. Reason flag tekee sen, että se tutkii verkon ja odottaa vastausta "ajattomasti".

Lähde: https://geek-university.com/nmap/the-reason-flag/

# e) Avaa yhteys HackTheBoxin verkkoon ja osoita, että yhteys toimii. Varmista esimerkkiosoitteella, että olet yhteydessä oikeaan HackTheBox maaliverkkoon. #

Tulokset

# f) Tiedustele aktiivisesti HackTheBoxin verkko. Analysoi tulokset. Käytä nmap-porttiskanneria. Seuraa koko ajan porttiskannerin toimintaa snifferillä, kuten tshark tai wireshark. #

Tulokset


Läksyjen lähde:http://terokarvinen.com/2020/tunkeutumistestaus-kurssi-pentest-course-ict4tn027-3006-autumn-2020/
